# 관리자용 운영 가이드

## 개요

이 문서는 JaBlog 시스템 관리자를 위한 운영 가이드입니다. 사용자 권한 관리, 발행 정책 설정, API 키 관리, 로그 확인 절차 등 관리 업무에 필요한 정보를 제공합니다.

---

## 사용자 권한 관리

### 사용자 역할

| 역할   | 권한               | 설명                                     |
| ------ | ------------------ | ---------------------------------------- |
| ADMIN  | 전체 권한          | 시스템 설정, 사용자 관리, 모든 기능 접근 |
| EDITOR | 콘텐츠 관리 + 발행 | 콘텐츠 CRUD, 발행, 예약                  |
| AUTHOR | 콘텐츠 작성        | 본인 콘텐츠 작성/수정만 가능             |
| VIEWER | 읽기 전용          | 대시보드 및 분석 조회                    |

### 역할별 메뉴 접근

| 메뉴            | ADMIN | EDITOR | AUTHOR      | VIEWER |
| --------------- | ----- | ------ | ----------- | ------ |
| 대시보드        | ✅    | ✅     | ✅          | ✅     |
| 콘텐츠          | ✅    | ✅     | ✅ (본인만) | ❌     |
| 발행 파이프라인 | ✅    | ✅     | ✅          | ❌     |
| 예약 캘린더     | ✅    | ✅     | ✅          | ✅     |
| 성과 분석       | ✅    | ✅     | ✅          | ✅     |
| API 모니터링    | ✅    | ✅     | ❌          | ❌     |
| 사용자 관리     | ✅    | ❌     | ❌          | ❌     |
| 설정            | ✅    | ✅     | ✅ (일부)   | ❌     |

### 사용자 관리 작업

| 작업             | 경로                          | 설명               |
| ---------------- | ----------------------------- | ------------------ |
| 사용자 목록 조회 | /dashboard/users              | 모든 사용자 확인   |
| 사용자 추가      | /dashboard/users → 추가       | 새 계정 생성       |
| 역할 변경        | 사용자 선택 → 역할 수정       | 권한 조정          |
| 사용자 비활성화  | 사용자 선택 → 비활성화        | 접근 차단          |
| 비밀번호 초기화  | 사용자 선택 → 비밀번호 초기화 | 임시 비밀번호 발급 |

---

## 발행 정책 설정

### 콘텐츠 워크플로우

| 설정 항목      | 옵션         | 기본값 | 설명                       |
| -------------- | ------------ | ------ | -------------------------- |
| 검토 필수 여부 | 예/아니오    | 예     | 발행 전 검토 단계 필수     |
| 자동 승인 역할 | ADMIN/EDITOR | ADMIN  | 자동 승인 가능 역할        |
| 예약 최소 시간 | 분 단위      | 5분    | 현재로부터 최소 예약 간격  |
| 동시 발행 수   | 숫자         | 3      | 동시 발행 가능한 플랫폼 수 |

### 플랫폼별 설정

| 플랫폼    | 설정 항목     | 설명                    |
| --------- | ------------- | ----------------------- |
| WordPress | 기본 카테고리 | 미지정 시 기본 카테고리 |
| WordPress | 기본 태그     | 공통 태그 자동 추가     |
| Tistory   | 공개 범위     | 전체공개/보호           |
| Tistory   | 댓글 허용     | 댓글 가능 여부          |

---

## API 키 관리

### 외부 API 키

| API           | 용도           | 관리 위치      | 갱신 주기 |
| ------------- | -------------- | -------------- | --------- |
| Google Trends | 키워드 분석    | 설정 → AI 설정 | - (무료)  |
| OpenAI        | AI 콘텐츠 생성 | 설정 → AI 설정 | 무기한    |
| Anthropic     | AI 콘텐츠 생성 | 설정 → AI 설정 | 무기한    |
| Google Gemini | AI 콘텐츠 생성 | 설정 → AI 설정 | 무기한    |

### API 키 보안 관리

| 항목      | 권장 사항         | 비고                  |
| --------- | ----------------- | --------------------- |
| 저장 위치 | 환경 변수 (.env)  | 코드에 직접 포함 금지 |
| 접근 권한 | ADMIN만 수정 가능 | 역할 기반 접근 제어   |
| 표시 방식 | 마스킹 (\*\*\*\*) | 전체 표시 금지        |
| 갱신 기록 | 로그 기록         | 변경 추적             |

### API 키 환경 변수

```env
# .env 파일 예시
DATABASE_URL="postgresql://user:pass@localhost:5432/jablog"
JWT_SECRET="your-jwt-secret"

# AI API Keys
OPENAI_API_KEY="sk-..."
ANTHROPIC_API_KEY="sk-ant-..."
GEMINI_API_KEY="..."

# Platform Credentials (개인 설정에서 관리)
WORDPRESS_URL="https://myblog.com"
WORDPRESS_USERNAME="admin"
WORDPRESS_APP_PASSWORD="..."

TISTORY_ACCESS_TOKEN="..."
```

---

## 로그 확인 절차

### 로그 유형

| 로그 유형         | 위치                  | 내용               | 보존 기간 |
| ----------------- | --------------------- | ------------------ | --------- |
| 애플리케이션 로그 | 터미널 출력           | 일반 동작, 오류    | 세션 동안 |
| API 호출 로그     | /dashboard/monitoring | 외부 API 호출 기록 | 30일      |
| 발행 로그         | 콘텐츠 상세           | 발행 결과, 시간    | 무기한    |
| 사용자 활동 로그  | DB                    | 로그인, 작업 기록  | 90일      |

### 로그 확인 방법

#### 1. API 모니터링 대시보드

1. **API 모니터링** 메뉴로 이동합니다.
2. 기간 필터로 조회 범위를 선택합니다.
3. 오류 필터로 실패한 호출만 확인합니다.
4. 상세 로그를 클릭하여 요청/응답 확인합니다.

#### 2. 서버 터미널 로그

```bash
# 백엔드 서버 로그 확인
cd backend
npm run dev

# 로그 예시
[2024-12-01 10:00:00] INFO: Server started on port 4000
[2024-12-01 10:01:00] INFO: POST /publishing/all - 200 OK
[2024-12-01 10:02:00] ERROR: WordPress API error - 401 Unauthorized
```

#### 3. 데이터베이스 로그

```sql
-- 최근 발행 기록 조회
SELECT * FROM "ScheduledPost"
WHERE status = 'FAILED'
ORDER BY "createdAt" DESC
LIMIT 20;

-- 사용자 활동 조회
SELECT * FROM "AuditLog"
WHERE "userId" = 1
ORDER BY "createdAt" DESC;
```

---

## 시스템 모니터링

### 상태 점검 항목

| 항목         | 확인 방법                    | 정상 기준   | 조치         |
| ------------ | ---------------------------- | ----------- | ------------ |
| 백엔드 서버  | http://localhost:4000/health | 200 OK      | 서버 재시작  |
| 프론트엔드   | http://localhost:3000        | 페이지 로드 | 서버 재시작  |
| 데이터베이스 | Prisma 연결                  | 연결 성공   | DB 서버 확인 |
| 외부 API     | 연결 테스트                  | SUCCESS     | 키/설정 확인 |

### 성능 지표

| 지표          | 권장 범위      | 모니터링 방법 |
| ------------- | -------------- | ------------- |
| API 응답 시간 | < 500ms        | API 모니터링  |
| 발행 성공률   | > 95%          | 발행 로그     |
| 오류율        | < 5%           | API 모니터링  |
| 동시 접속자   | 서버 용량 이내 | 서버 로그     |

---

## 백업 및 복구

### 백업 항목

| 항목         | 빈도    | 방법      | 보존     |
| ------------ | ------- | --------- | -------- |
| 데이터베이스 | 매일    | pg_dump   | 30일     |
| 환경 설정    | 변경 시 | .env 복사 | 최근 5개 |
| 콘텐츠 파일  | 매주    | 파일 백업 | 4주      |

### 복구 절차

1. **데이터베이스 복구**

   ```bash
   # 백업에서 복구
   psql -U user -d jablog < backup.sql
   ```

2. **환경 설정 복구**

   ```bash
   # .env 파일 복원
   cp .env.backup .env
   ```

3. **서비스 재시작**
   ```bash
   npm run build
   npm run start
   ```

---

## 보안 점검

### 정기 점검 항목

| 항목            | 주기 | 확인 내용        | 담당  |
| --------------- | ---- | ---------------- | ----- |
| API 키          | 월간 | 만료/노출 여부   | ADMIN |
| 사용자 권한     | 분기 | 불필요 권한 정리 | ADMIN |
| 비활성 계정     | 분기 | 90일 미접속 계정 | ADMIN |
| 로그 검토       | 주간 | 비정상 접근 확인 | ADMIN |
| 의존성 업데이트 | 월간 | 보안 패치 적용   | ADMIN |

### 보안 권장사항

1. **강력한 비밀번호** 정책 적용
2. **2단계 인증** 도입 고려
3. **정기적인 API 키 교체**
4. **접근 로그 정기 검토**
5. **HTTPS 적용** 필수

---

## 문제 해결 연락처

| 문제 유형   | 담당          | 연락처             |
| ----------- | ------------- | ------------------ |
| 시스템 오류 | DevOps        | admin@jablog.com   |
| 권한 문제   | 시스템 관리자 | admin@jablog.com   |
| 플랫폼 연동 | 기술 지원     | support@jablog.com |
| 기능 요청   | 제품팀        | product@jablog.com |

---

_이 가이드는 시스템 관리자를 위해 작성되었습니다._
